<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FoodieGoodies</title>
    <link href="images/logo.png" type="image/x-icon" rel="icon" />

    <!-- Icon Font Stylesheet -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />

    <!-- Template Stylesheet -->
    <link href="./css/style.css" rel="stylesheet" />

    <!--Google Fonts-->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Import chart.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

    <!-- Vue -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  </head>

  <body>
    <!-- Topbar Start -->
    <div class="container-fluid px-5 d-none d-lg-block topBar">
      <div class="row gx-5 py-3 align-items-center">
        <div class="col-lg-3">
          <div class="d-flex align-items-center justify-content-start"></div>
        </div>
        <div class="col-lg-6">
          <div class="d-flex align-items-center justify-content-center">
            <a href="landingPage.html" class="navbar-brand ms-lg-5">
              <h1 class="m-0">
                <span class="basic1">Foodie </span
                ><span class="basic2">Goodies</span>
              </h1>
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- Top bar end -->

    <!-- Navbar Start -->
    <nav
      class="navbar navbar-expand-lg bgBasic1 navbar-dark shadow-sm py-3 py-lg-0 px-3 px-lg-5 sticky-top"
    >
      <div class="navbar-brand d-flex d-lg-none">
        <h1 class="m-0 display-4">
          <span class="text-light">Foodie </span>Goodies
        </h1>
      </div>

      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarCollapse"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav mx-auto py-0">
          <a href="landingPage.html" class="nav-item nav-link mx-2">Home</a>
          <a href="restaurantSelection.html" class="nav-item nav-link mx-2"
            >Restaurant Selection</a
          >
          <a href="shoppingCart.html" class="nav-item nav-link mx-2"
            >Shopping Cart</a
          >
          <a href="orderHistory.html" class="nav-item nav-link mx-2"
            >Order History</a
          >
          <a href="personalProfile.html" class="nav-item nav-link mx-2 active"
            >Your Profile</a
          >
        </div>
      </div>
    </nav>
    <!-- Navbar End -->

    <div id="app">
      <div class="mx-auto w-50">
        <canvas id="emissionsChart">{{getCarbonEmissions()}}</canvas>
      </div>

      <div class="mx-auto w-50">
        <canvas id="toppurchasesChart"></canvas>
      </div>
    </div>
    <!-- user emissions chart -->

    <!-- bar chart  -->
    <!-- <canvas id="barChart" width="100" height="20"></canvas>
    <script>
      // Bar chart
      new Chart("barChart", {
        type: "bar",
        data: {
          labels: [],
          datasets: [
            {
              label: "Population (millions)",
              backgroundColor: [
                "#3e95cd",
                "#8e5ea2",
                "#3cba9f",
                "#e8c3b9",
                "#c45850",
              ],
              data: [2478, 5267, 734, 784, 433],
            },
          ],
        },
        options: {
          legend: { display: false },
          title: {
            display: true,
            text: "Predicted world population (millions) in 2050",
          },
        },
      });
    </script> -->

    <!-- polar chart for user purchase categories
    <canvas id="purchaseCategories" width="100" height="30"></canvas>
    <script>
      new Chart("purchaseCategories", {
        type: "polarArea",
        data: {
          labels: ["Japanese", "Western", "Italian", "Thai", ""],
          datasets: [
            {
              label: "Population (millions)",
              backgroundColor: [
                "#3e95cd",
                "#8e5ea2",
                "#3cba9f",
                "#e8c3b9",
                "#c45850",
              ],
              data: [2478, 5267, 734, 784, 433],
            },
          ],
        },
        options: {
          title: {
            display: true,
            text: "Predicted world population (millions) in 2050",
          },
        },
      });
    </script> -->

    <!-- functions -->
    <script type="module">
      import { onValue, ref, db } from "./index.js";

      const app = Vue.createApp({
        data() {
          return {
            uid: "0RikLHfzYTSOd1Nx46LKdKavZNd2",
            year: 2022,
          };
        },
        methods: {
          //get user's carbon emissions by month
          getCarbonEmissions() {
            onValue(
              ref(db, `users/${this.uid}/carbonEmissionsSaved/${this.year}`),
              (snapshot) => {
                const emissions = snapshot.val();
                //if emissions exist, create emissions chart
                if (emissions) {
                  this.renderEmissionsChart(emissions, this.year);
                }
                // Use the emissions data for that year
              }
            );
          },

          // generate user's carbon emissions graph
          renderEmissionsChart(emissions, year) {
            const allMonths = [
              "January",
              "February",
              "March",
              "April",
              "May",
              "June",
              "July",
              "August",
              "September",
              "October",
              "November",
              "December",
            ];
            // Extract months from the emissions object that have values
            const monthsWithData = allMonths.filter(
              (month) => emissions[month] && emissions[month] !== 0
            );
            console.log(monthsWithData); //array of months with data

            // Extract emission values for the months
            const monthlyEmissions = monthsWithData.map(
              (month) => emissions[month]
            );
            console.log(monthlyEmissions); //array of the corresponding emissions with the month

            const ctx = document
              .getElementById("emissionsChart")
              .getContext("2d");

            new Chart(ctx, {
              type: "line",
              data: {
                labels: monthsWithData.map(
                  (month) => month.charAt(0).toUpperCase() + month.slice(1)
                ), // Capitalize the first letter of each month
                datasets: [
                  {
                    label: `Carbon Emissions prevented by month (${year})`,
                    data: monthlyEmissions,
                    borderColor: "rgb(75, 192, 192)",
                    fill: false,
                    tension: 0,
                  },
                ],
              },
              options: {
                responsive: true,
                scales: {
                  y: {
                    beginAtZero: true,
                  },
                },
              },
            });
          },

          // get user's top purchases
          getTopPurchases() {
            onValue(
              ref(db, `users/${userId}/carbonEmissionsSaved/`),
              (snapshot) => {}
            );
          },
        },
      });
      const vm = app.mount("#app");
    </script>
  </body>
</html>
